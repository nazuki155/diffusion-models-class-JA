# ãƒ¦ãƒ‹ãƒƒãƒˆ1ï¼šDiffusionãƒ¢ãƒ‡ãƒ«å…¥é–€

Hugging Face Diffusionãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆ1ã¸ã‚ˆã†ã“ã!ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆã§ã¯ã€æ‹¡æ•£ãƒ¢ãƒ‡ãƒ«ã®ä»•çµ„ã¿ã®åŸºæœ¬ã‚’å­¦ã³ã€
ğŸ¤— Diffusers ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ç‹¬è‡ªã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

## ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹ :rocket:

ãƒ¦ãƒ‹ãƒƒãƒˆã®æ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:

- æ–°ã—ã„æ•™æãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã¨ãã«é€šçŸ¥ã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã€[ã“ã®ã‚³ãƒ¼ã‚¹ã«ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—](https://huggingface.us17.list-manage.com/subscribe?u=7f57e683fa28b51bfc493d048&id=ef963b4162)ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- ä»¥ä¸‹ã®ç´¹ä»‹è³‡æ–™ã¨ã€èˆˆå‘³ã®ã‚ã‚Šãã†ãªè¿½åŠ è³‡æ–™ã«ç›®ã‚’é€šã—ã¦ãã ã•ã„
- ä»¥ä¸‹ã® _**Introduction to Diffusers**_ ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã§ã€ğŸ¤—Diffusersãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸç†è«–ã®å®Ÿè·µã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„
- ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã¾ãŸã¯ãƒªãƒ³ã‚¯ã•ã‚ŒãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ç‹¬è‡ªã®diffusionãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã€å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
- (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) æœ€å°é™ã®ã‚¼ãƒ­ã‹ã‚‰ã®å®Ÿè£…ã«èˆˆå‘³ãŒã‚ã‚Šã€æ§˜ã€…ãªè¨­è¨ˆä¸Šã®æ±ºå®šã‚’æ¤œè¨ã—ãŸã„å ´åˆã¯ã€ _**Diffusion Models from Scratch**_ ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã§ã‚ˆã‚Šæ·±ãæ˜ã‚Šä¸‹ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™
- (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) [ã“ã®ãƒ“ãƒ‡ã‚ª](https://www.youtube.com/watch?v=09o5cv6u76c)ã§ã€ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆã®æ•™æã‚’ã–ã£ã¨è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚


:loudspeaker: [Discord](https://huggingface.co/join/discord)ã«å‚åŠ ã™ã‚‹ã®ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚ã“ã“ã§ã¯ã€`#diffusion-models-class`ãƒãƒ£ãƒ³ãƒãƒ«ã§æ•™æã«ã¤ã„ã¦è­°è«–ã—ãŸã‚Šã€ä½œã£ãŸã‚‚ã®ã‚’å…±æœ‰ã—ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## Diffusionãƒ¢ãƒ‡ãƒ«ã¨ã¯ä½•ã‹ï¼Ÿ

Diffusionãƒ¢ãƒ‡ãƒ«ã¨ã¯ã€ã€Œç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã€ã¨å‘¼ã°ã‚Œã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ç¾¤ã«æ¯”è¼ƒçš„æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚ç”Ÿæˆãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã®ç›®çš„ã¯ã€å¤šãã®å­¦ç¿’ä¾‹ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã«ã€ç”»åƒã‚„éŸ³å£°ãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’ **ç”Ÿæˆã™ã‚‹** ã“ã¨ã‚’å­¦ç¿’ã™ã‚‹ã“ã¨ã§ã™ã€‚å„ªã‚ŒãŸç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã¯ã€å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’æ­£ç¢ºã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ãªãã€ãã‚Œã«é¡ä¼¼ã—ãŸ **å¤šæ§˜ãª** å‡ºåŠ›ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚diffusionãƒ¢ãƒ‡ãƒ«ã¯ã©ã®ã‚ˆã†ã«ã—ã¦ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿã“ã“ã§ã¯ã€èª¬æ˜ã®ãŸã‚ã«ç”»åƒç”Ÿæˆã®ã‚±ãƒ¼ã‚¹ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

<p align="center">
    <img src="https://user-images.githubusercontent.com/10695622/174349667-04e9e485-793b-429a-affe-096e8199ad5b.png" width="800"/>
    <br>
    <em> Figure from DDPM paper (https://arxiv.org/abs/2006.11239). </em>
<p>

diffusionãƒ¢ãƒ‡ãƒ«ã®æˆåŠŸã®ç§˜å¯†ã¯ã€diffusionãƒ—ãƒ­ã‚»ã‚¹ã®åå¾©æ€§ã«ã‚ã‚Šã¾ã™ã€‚ç”Ÿæˆã¯ãƒ©ãƒ³ãƒ€ãƒ ãªãƒã‚¤ã‚ºã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ãŒã€å‡ºåŠ›ç”»åƒãŒç¾ã‚Œã‚‹ã¾ã§ã€ä½•æ®µéšã«ã‚‚ã‚ãŸã£ã¦å¾ã€…ã«æ´—ç·´ã•ã‚Œã¦ã„ãã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã«ãŠã„ã¦ã€ãƒ¢ãƒ‡ãƒ«ã¯ç¾åœ¨ã®å…¥åŠ›ã‹ã‚‰å®Œå…¨ã«ãƒã‚¤ã‚ºé™¤å»ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¾ã§ã©ã®ã‚ˆã†ã«é€²ã‚€ã‹ã‚’æ¨å®šã—ã¾ã™ã€‚ã—ã‹ã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§å°ã•ãªå¤‰æ›´ã‚’åŠ ãˆã‚‹ã ã‘ãªã®ã§ã€åˆæœŸæ®µéšï¼ˆæœ€çµ‚çš„ãªå‡ºåŠ›ã‚’äºˆæ¸¬ã™ã‚‹ã“ã¨ãŒéå¸¸ã«é›£ã—ã„æ®µéšï¼‰ã§ã®ã“ã®æ¨å®šå€¤ã®èª¤å·®ã¯ã€å¾Œã®æ›´æ–°ã§ä¿®æ­£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã¯ã€ä»–ã®ã‚¿ã‚¤ãƒ—ã®ç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã«æ¯”ã¹ã¦æ¯”è¼ƒçš„ç°¡å˜ã§ã™ã€‚ä»¥ä¸‹ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™
1) å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç”»åƒã‚’ã„ãã¤ã‹èª­ã¿è¾¼ã‚€
2) æ§˜ã€…ãªé‡ã®ãƒã‚¤ã‚ºã‚’åŠ ãˆã‚‹ã€‚ã“ã®ã¨ãã€æ¥µç«¯ã«ãƒã‚¤ã‚ºã®å¤šã„ç”»åƒã¨å®Œç’§ã«è¿‘ã„ç”»åƒã®ä¸¡æ–¹ã‚’ã€Œä¿®æ­£ã€ï¼ˆãƒã‚¤ã‚ºé™¤å»ï¼‰ã™ã‚‹æ–¹æ³•ã‚’ãƒ¢ãƒ‡ãƒ«ãŒã†ã¾ãæ¨å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
3) ãƒã‚¤ã‚ºãŒã‹ã‹ã£ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å…¥åŠ›ã‚’ãƒ¢ãƒ‡ãƒ«ã«é€ã‚Šè¾¼ã‚€
4) ã“ã‚Œã‚‰ã®å…¥åŠ›ã«å¯¾ã—ã¦ã€ãƒ¢ãƒ‡ãƒ«ãŒã©ã®ç¨‹åº¦ãƒã‚¤ã‚ºé™¤å»ã‚’è¡Œã†ã‹ã‚’è©•ä¾¡ã™ã‚‹
5) ã“ã®æƒ…å ±ã‚’ä½¿ã£ã¦ãƒ¢ãƒ‡ãƒ«ã®é‡ã¿ã‚’æ›´æ–°ã™ã‚‹
    
å­¦ç¿’ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦æ–°ã—ã„ç”»åƒã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€ã¾ãšå®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ ãªå…¥åŠ›ã‹ã‚‰å§‹ã‚ã¦ã€ãã‚Œã‚’ç¹°ã‚Šè¿”ã—ãƒ¢ãƒ‡ãƒ«ã«ä¸ãˆã€ãƒ¢ãƒ‡ãƒ«ã®äºˆæ¸¬ã«åŸºã¥ã„ã¦æ¯å›å°‘ã—ãšã¤æ›´æ–°ã—ã¦ã„ãã¾ã™ã€‚å¾Œè¿°ã—ã¾ã™ãŒã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åŠ¹ç‡åŒ–ã—ã€ã§ãã‚‹ã ã‘å°‘ãªã„ã‚¹ãƒ†ãƒƒãƒ—ã§è‰¯ã„ç”»åƒã‚’ç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã®ã‚„ã‚Šæ–¹ãŒæ•°å¤šãå­˜åœ¨ã—ã¾ã™ã€‚

ã“ã®ãƒ¦ãƒ‹ãƒƒãƒˆ1ã§ã¯ã€ãã‚Œãã‚Œã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒãƒ³ã‚ºã‚ªãƒ³ãƒãƒ¼ãƒˆã§è©³ã—ãç´¹ä»‹ã—ã¾ã™ã€‚ãƒ¦ãƒ‹ãƒƒãƒˆ2ã§ã¯ã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã©ã®ã‚ˆã†ã«å¤‰æ›´ã—ã€è¿½åŠ ã®æ¡ä»¶ä»˜ã‘ï¼ˆã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ«ãªã©ï¼‰ã‚„ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã¨ã„ã£ãŸæ‰‹æ³•ã«ã‚ˆã£ã¦ã€ãƒ¢ãƒ‡ãƒ«ã®å‡ºåŠ›ã«ã•ã‚‰ãªã‚‹åˆ¶å¾¡ã‚’åŠ ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ãã—ã¦ãƒ¦ãƒ‹ãƒƒãƒˆ3ã¨4ã§ã¯ã€Stable Diffusionã¨å‘¼ã°ã‚Œã‚‹éå¸¸ã«å¼·åŠ›ãªdiffusionãƒ¢ãƒ‡ãƒ«ã‚’æ¢æ±‚ã—ã¾ã™ã€‚ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã®èª¬æ˜ãŒä¸ãˆã‚‰ã‚ŒãŸã¨ãã«ç”»åƒã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

## ãƒãƒ³ã‚ºã‚ªãƒ³ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯

ã“ã®æ™‚ç‚¹ã§ã€ä»˜å±ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã«å–ã‚Šæ›ã‹ã‚‹ã®ã«ååˆ†ãªçŸ¥è­˜ãŒã‚ã‚‹ã®ã§ã™!ã“ã®2ã¤ã®ãƒãƒ¼ãƒˆã¯ã€åŒã˜ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç•°ãªã‚‹æ–¹æ³•ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

| Chapter                                     | Colab                                                                                                                                                                                               | Kaggle                                                                                                                                                                                                   | Gradient                                                                                                                                                                               | Studio Lab                                                                                                                                                                                                   |
|:--------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Introduction to Diffusers                                | [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/huggingface/diffusion-models-class/blob/main/unit1/01_introduction_to_diffusers.ipynb)              | [![Kaggle](https://kaggle.com/static/images/open-in-kaggle.svg)](https://kaggle.com/kernels/welcome?src=https://github.com/huggingface/diffusion-models-class/blob/main/unit1/01_introduction_to_diffusers.ipynb)              | [![Gradient](https://assets.paperspace.io/img/gradient-badge.svg)](https://console.paperspace.com/github/huggingface/diffusion-models-class/blob/main/unit1/01_introduction_to_diffusers.ipynb)              | [![Open In SageMaker Studio Lab](https://studiolab.sagemaker.aws/studiolab.svg)](https://studiolab.sagemaker.aws/import/github/huggingface/diffusion-models-class/blob/main/unit1/01_introduction_to_diffusers.ipynb)              |
| Diffusion Models from Scratch                                | [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/huggingface/diffusion-models-class/blob/main/unit1/02_diffusion_models_from_scratch.ipynb)              | [![Kaggle](https://kaggle.com/static/images/open-in-kaggle.svg)](https://kaggle.com/kernels/welcome?src=https://github.com/huggingface/diffusion-models-class/blob/main/unit1/02_diffusion_models_from_scratch.ipynb)              | [![Gradient](https://assets.paperspace.io/img/gradient-badge.svg)](https://console.paperspace.com/github/huggingface/diffusion-models-class/blob/main/unit1/02_diffusion_models_from_scratch.ipynb)              | [![Open In SageMaker Studio Lab](https://studiolab.sagemaker.aws/studiolab.svg)](https://studiolab.sagemaker.aws/import/github/huggingface/diffusion-models-class/blob/main/unit1/02_diffusion_models_from_scratch.ipynb)              |

In _**Introduction to Diffusers**_, we show the different steps described above using building blocks from the diffusers library. You'll quickly see how to create, train and sample your own diffusion models on whatever data you choose. By the end of the notebook, you'll be able to read and modify the example training script to train diffusion models and share them with the world! This notebook also introduces the main exercise associated with this unit, where we will collectively attempt to figure out good 'training recipes' for diffusion models at different scales - see the next section for more info.

In _**Diffusion Models from Scratch**_, we show those same steps (adding noise to data, creating a model, training and sampling) but implemented from scratch in PyTorch as simply as possible. Then we compare this 'toy example' with the diffusers version, noting how the two differ and where improvements have been made. The goal here is to gain familiarity with the different components and the design decisions that go into them so that when you look at a new implementation you can quickly identify the key ideas.

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ 

ã•ã¦ã€åŸºæœ¬ã‚’æŠ¼ã•ãˆãŸã¨ã“ã‚ã§ã€1ã¤ã¾ãŸã¯è¤‡æ•°ã®æ‹¡æ•£ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã¿ã¾ã—ã‚‡ã†!ã„ãã¤ã‹ã®ææ¡ˆã¯ã€ _**Introduction to Diffusers**_ ã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã®æœ€å¾Œã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®çµæœã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¬ã‚·ãƒ”ã€ç™ºè¦‹ã‚’ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨å…±æœ‰ã—ã€ã“ã‚Œã‚‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã‚’å…±åŒã§è¦‹ã¤ã‘å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

## è¿½åŠ è³‡æ–™

[The Annotated Diffusion Model](https://huggingface.co/blog/annotated-diffusion) is a very in-depth walk-through of the code and theory behind DDPMs with
 maths and code showing all the different components. It also links to a number of papers for further reading.

Hugging Face documentation on [Unconditional Image-Generation](https://huggingface.co/docs/diffusers/training/unconditional_training) for some examples of how to train diffusion models using the official training example script, including code showing how to create your own dataset.

AI Coffee Break video on Diffusion Models: https://www.youtube.com/watch?v=344w5h24-h8

Yannic Kilcher Video on DDPMs: https://www.youtube.com/watch?v=W-O7AZNzbzQ

Found more great resources? Let us know and we'll add them to this list.
